<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Resumen de Indicadores Financieros</title>
<style type="text/css">

body {
  background: #ffffff;
  min-width: 15cm;
  margin: 0;
  padding: 0;
}

.page {
  background: white;
  margin: 0 auto;
  margin-bottom: 0.5cm;
  box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
  page-break-after: always;
}

.page[size="A3"] {
  width: 29.7cm;
  height: 42cm;
}

/* Ajustes para la impresión */
@media print {
  .table-section, .graph-section {
    page-break-before: always;
  }

  .table, .graph {
    page-break-inside: avoid;
  }
}

.main {
  background-color: #ffffff;
  margin: auto;
  width: 100%;
  max-width: 29.7cm;
  font-family: sans-serif;
  color: #4a4a4a;
  font-size: 12px;
  line-height: 1.5;
}

.subtitulos {
  font-weight: bold;
  font-size: 16px;
  color: #45546A;
  text-align: left;
  margin-bottom: 10px;
}

.etiquetas {
  color: #45546A;
  font-weight: bold;
}

.datos {
  font-weight: bold;
  font-size: 14px;
}

.b2 {
  background-color: #ffffff;
  text-align: left;
  line-height: 1.5;
}

.contenedor-columnas {
  text-align: center;
  vertical-align: top;
}

.tables-headers {
  background-color: #45546A;
  color: #ffffff;
  font-weight: bold;
  text-align: center;
}

.tables-body tr {
  height: 10px;
  vertical-align: middle;
}

.tables-body td {
  padding: 5px;
}

.table-section, .graph-section {
  page-break-before: always;
  margin-bottom: 10px;
}

.container {
  width: 100%;
  margin: 0 auto;
  padding: 0;
  page-break-before: always;
}

/* Ajuste de márgenes entre secciones */
.section {
  margin: 20px 0;
  padding: 10px 0;
}

.section-header {
  font-size: 14px;
  font-weight: bold;
  color: #45546A;
  margin-bottom: 10px;
}

/* Ajuste de espacios internos */
.table {
  width: 100%;
  border-collapse: collapse;
  margin: 10px 0;
}

.table th, .table td {
  padding: 2px;
  text-align: left;
  border: 1px solid #ddd;
}

/* Alinear contenido */
.center {
  text-align: center;
}

.right {
  text-align: right;
}


       
	</style>
</head>

<body>



        <table class="main" width="100%" style="padding: 20px; margin: auto;">

<!-- TITULO -->

        <tr>
             <td height="50px" style="background-color: #45546A; color:#ffffff; font-size: 24px; text-align: center;"><strong>Resumen de Indicadores Financieros</strong></td>
         </tr>


<!-- DATOS CLIENTE -->           

         <tr>
            <td class="b2">
                <table width="100%" style="margin: 50px 0 30px;">
                    <caption class="subtitulos">Datos Generales del Cliente</caption>
                    <tr>
                        <td class ="etiquetas" width="15%">Nombre del Cliente
                        </td>
                        <td class ="datos" width="85%">{{client}}</td>
                    </tr>
                    <tr>
                        <td class = "etiquetas" width="15%">Nro. Identificación
                        </td>
                        <td class ="datos" width="85%">{{document}}</td>
                    </tr>
                    <tr>
                        <td class = "etiquetas" width="15%">Actividad
                        </td>
                        <td class ="datos" width="85%">{{activity}}</td>
                    </tr>
                </table>
            </td>
         </tr>


<!-- INDICADORES DE ACTIVIDAD/EFICIENCIA -->  

<div class="container"></div>
<div class="table-section">
    <tr>
        <td>
            <table width="100%" style="margin: 2px 0 2px;">
                <tr>
                    <td class="contenedor-columnas" width="40%">
                        
                        <table id="data-table" class="tables-body" width="100%">
                            <caption class="subtitulos">Indicadores de Actvidad/Eficiencia</caption>
                            
                            <tr class="tables-headers">
                                <th>Indicador</th>
                                <th>{{indicators.activityEfficiency.period_3.period | stringformat:"i"}}</th>
                                <th>{{indicators.activityEfficiency.period_2.period | stringformat:"i"}}</th>
                                <th>{{indicators.activityEfficiency.period_1.period | stringformat:"i"}}</th>
                            </tr>
                            
                                <tr id="wallet-rotation-row">
                                    <td style="text-align: left; font-weight: bold; padding: 1px 0 1px;" >Rotación Cartera</td>
                                    <td>{{indicators.activityEfficiency.period_3.walletRotation}}</td>
                                    <td>{{indicators.activityEfficiency.period_2.walletRotation}}</td>
                                    <td>{{indicators.activityEfficiency.period_1.walletRotation}}</td>
                                </tr>
                                <tr id="inventoryRotation">
                                    <td style="text-align: left; font-weight: bold; padding: 1px 0 1px;">Rotación Inventario</td>
                                    <td>{{indicators.activityEfficiency.period_3.inventoryRotation}}</td>
                                    <td>{{indicators.activityEfficiency.period_2.inventoryRotation}}</td>
                                    <td>{{indicators.activityEfficiency.period_1.inventoryRotation}}</td>
                                </tr>
        
                                <tr id="operationalCycle">
                                    <td style="text-align: left; font-weight: bold; padding: 1px 0 1px;">Ciclo Operacional</td>
                                    <td>{{indicators.activityEfficiency.period_3.operationalCycle}}</td>
                                    <td>{{indicators.activityEfficiency.period_2.operationalCycle}}</td>
                                    <td>{{indicators.activityEfficiency.period_1.operationalCycle}}</td>
                                </tr>
        
                                <tr id="providersRotation">
                                    <td style="text-align: left; font-weight: bold; padding: 1px 0 1px;">Rotación Proveedores</t>
                                    <td>{{indicators.activityEfficiency.period_3.providersRotation}}</td>
                                    <td>{{indicators.activityEfficiency.period_2.providersRotation}}</td>
                                    <td>{{indicators.activityEfficiency.period_1.providersRotation}}</td>
                                </tr>
        
                                <tr id="accumulatedExpensesRotation">
                                    <th style="text-align: left; font-weight: bold; padding: 1px 0 1px;">Rotación Gastos Acumulados</th>
                                    <td>{{indicators.activityEfficiency.period_3.accumulatedExpensesRotation}}</td>
                                    <td>{{indicators.activityEfficiency.period_2.accumulatedExpensesRotation}}</td>
                                    <td>{{indicators.activityEfficiency.period_1.accumulatedExpensesRotation}}</td>
                                </tr>
        
                                <tr id="cashConversionCycle">
                                    <th style="text-align: left; font-weight: bold; padding: 1px 0 1px;">Ciclo Conversión de Efectivo</th>
                                    <td>{{indicators.activityEfficiency.period_3.cashConversionCycle}}</td>
                                    <td>{{indicators.activityEfficiency.period_2.cashConversionCycle}}</td>
                                    <td>{{indicators.activityEfficiency.period_1.cashConversionCycle}}</td>
                                </tr>
        
                                <tr id="assetsRotation">
                                    <th style="text-align: left; font-weight: bold; padding: 1px 0 1px;">Rotación Activos</th>
                                    <td>{{indicators.activityEfficiency.period_3.assetsRotation}}</td>
                                    <td>{{indicators.activityEfficiency.period_2.assetsRotation}}</td>
                                    <td>{{indicators.activityEfficiency.period_1.assetsRotation}}</td>
                                </tr>
        
                             
                                                   
                        </table>
    
                    </td>
    
                   
                    
                    
                </tr>
    
               
            </table>
        </td>
     </tr>
    


</div>
<div class="graph-section">
    
    <tr>
        <td>
        <table>
            <tr>
                <td class="columna" width="60%" style="text-align: left; height: 200px;">
                    <canvas id="walletRotationChart"></canvas>
                </td>
                <td class="columna" width="60%" style="text-align: center; height: 200px;">
                    <canvas id="inventoryRotationChart"></canvas>
                </td>
                <td class="columna" width="60%" style="text-align: right; height: 200px;">
                    <canvas id="providersRotationChart"></canvas>
                </td>
            </tr>
         </table>
    
        </td>
    </tr>
    
</div>
    



 <script>
    // Función para convertir números regionales a formato estándar
    function parseNumber(numberString) {
        // Reemplazar puntos (separador de miles) por nada y comas (separador decimal) por puntos
        return parseFloat(numberString.replace(/\./g, '').replace(',', '.'));
    }

    Chart.register({
        id: 'barValuesPlugin',
        afterDatasetsDraw(chart) {
            const ctx = chart.ctx;

            // Iterar sobre cada dataset y sus barras
            chart.data.datasets.forEach((dataset, datasetIndex) => {
                const meta = chart.getDatasetMeta(datasetIndex);
                meta.data.forEach((bar, index) => {
                    const value = dataset.data[index];
                    const x = bar.x; // Coordenada X de la barra
                    const y = bar.y; // Coordenada Y de la barra

                    // Configuración del texto
                    ctx.save();
                    ctx.font = "12px Arial";
                    ctx.fillStyle = value >= 0 ? "green" : "red"; // Verde para positivos, rojo para negativos
                    ctx.textAlign = "center";
                    ctx.textBaseline = "bottom";

                    // Dibujar el valor encima de la barra
                    ctx.fillText(`${value > 0 ? "+" : ""}${value.toLocaleString()}`, x, y - 5);
                    ctx.restore();
                });
            });
        }
    });
    

    // Configuración general para los gráficos
    function createChart(ctx, label, data,  color = "rgba(64, 194, 214, 0.8)") {

        
        return new Chart(ctx, {
            type: "bar",
            data: {
                labels: ["Periodo 3", "Periodo 2", "Periodo 1"],
                datasets: [
                    {
                        label: label,
                        data: data,
                        backgroundColor: data.map((value, index) => {
    const gradient = ctx.createLinearGradient(0, 0, 0, ctx.canvas.height);
    const intensity = value / Math.max(...data); // Normalización

    // Calculamos los colores inicial y final basados en el color base #488b8f
    const baseColor = [72, 139, 143]; // RGB de #488b8f
    const startColor = `rgb(${Math.floor(baseColor[0] + intensity * 20)}, ${Math.floor(baseColor[1] + intensity * 10)}, ${Math.floor(baseColor[2])})`; // Color más claro
    const endColor = `rgb(${Math.floor(baseColor[0] - intensity * 20)}, ${Math.floor(baseColor[1] - intensity * 10)}, ${Math.floor(baseColor[2])})`; // Color más oscuro

    gradient.addColorStop(0, startColor);
    gradient.addColorStop(1, endColor);
    return gradient;
}),
                        borderColor: [
                            "rgba(72, 139, 143)",
                            "rgba(72, 139, 143)",
                            "rgba(72, 139, 143)"
                        ],
                        borderWidth: 1,
                        borderRadius: 10
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: "top",
                        labels: {
                        boxWidth: 0 // Esto elimina el cuadro de color al lado del texto
                    }
                    }
                },
                
                scales: {
                    y: {
                        beginAtZero: true,
                        stepSize: 100000, // Paso ajustado para valores grandes
                        max: Math.max(...data) * 1.1 // Margen superior para acomodar mejor las barras
                    }
                },
                animation: {
                    duration: 0 // Sin animación
                }
            }
        });
    }

    // Procesar filas de datos y generar gráficos
    function setupCharts() {
        const walletRow = document.getElementById("wallet-rotation-row");
        const inventoryRotationRow = document.getElementById("inventoryRotation");
        const providersRotationRow = document.getElementById("providersRotation");

        function getDataFromRow(row) {
        return Array.from(row?.querySelectorAll("td") || [])
            .slice(1)
            .map(cell => {
                const value = parseNumber(cell.textContent.trim());
                return isNaN(value) ? 0 : value; // Si no es un número, poner 0
            });
    }

    const walletData = getDataFromRow(walletRow);
    const inventoryData = getDataFromRow(inventoryRotationRow);
    const providersData = getDataFromRow(providersRotationRow);

        const walletCtx = document.getElementById("walletRotationChart").getContext("2d");
        const inventoryCtx = document.getElementById("inventoryRotationChart").getContext("2d");
        const providersCtx = document.getElementById("providersRotationChart").getContext("2d");

        createChart(walletCtx, "Rotación Cartera", walletData);
        createChart(inventoryCtx, "Rotación Inventario", inventoryData);
        createChart(providersCtx, "Rotación Proveedores", providersData);
    }

    // Inicializar gráficos
    setupCharts();
</script>




 <!-- INDICADORES DE RENTABILIDAD -->  
 <div class="table-section">

    <tr>
        <td>
            <table width="100%" style="margin: 30px 0 30px; vertical-align: top;">
                <tr>
                    <td class="contenedor-columnas" width="40%">
                        
                        <table class="tables-body" width="100%">
                            <caption class="subtitulos">Indicadores de Rentabilidad</caption>
                            <tr class="tables-headers">
                                <th>Indicador</th>
                                <th>{{indicators.rentability.period_3.period | stringformat:"i"}}</th>
                                <th>{{indicators.rentability.period_2.period | stringformat:"i"}}</th>
                                <th>{{indicators.rentability.period_1.period | stringformat:"i"}}</th>
                            </tr>
    
                            <tr id="margenbruto">
                                <th style="text-align: left; font-weight: bold; padding: 3px 0 3px;">Margen Bruto</th>
                                <td>{{indicators.rentability.period_3.grossMargin}}</td>
                                <td>{{indicators.rentability.period_2.grossMargin}}</td>
                                <td>{{indicators.rentability.period_1.grossMargin}}</td>
                            </tr>
    
                            <tr id="margenoperacional">
                                <th style="text-align: left; font-weight: bold; padding: 3px 0 3px;">Margen Operacional</th>
                                <td>{{indicators.rentability.period_3.operationalMargin}}</td>
                                <td>{{indicators.rentability.period_2.operationalMargin}}</td>
                                <td>{{indicators.rentability.period_1.operationalMargin}}</td>
                            </tr>
    
                            <tr id="ebitda">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">EBITDA</td>
                                <td>{{indicators.rentability.period_3.EBITDA}}</td>
                                <td>{{indicators.rentability.period_2.EBITDA}}</td>
                                <td>{{indicators.rentability.period_1.EBITDA}}</td>
                            </tr>
    
                            <tr id="margenebitda">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">Margen EBITDA</td>
                                <td>{{indicators.rentability.period_3.EBITDAMargin}}</td>
                                <td>{{indicators.rentability.period_2.EBITDAMargin}}</td>
                                <td>{{indicators.rentability.period_1.EBITDAMargin}}</td>
                            </tr>
    
                            <tr id="margenneto">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">Margen Neto</td>
                                <td>{{indicators.rentability.period_3.netMargin}}</td>
                                <td>{{indicators.rentability.period_2.netMargin}}</td>
                                <td>{{indicators.rentability.period_1.netMargin}}</td>
                            </tr>
    
                            <tr id="rentactot">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">Rentabilidad del Activo Total</td>
                                <td>{{indicators.rentability.period_3.rentabilityTotalAssets}}</td>
                                <td>{{indicators.rentability.period_2.rentabilityTotalAssets}}</td>
                                <td>{{indicators.rentability.period_1.rentabilityTotalAssets}}</td>
                            </tr>
    
                            <tr id="rentpat">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">Rentabilidad del Patrimonio</td>
                                <td>{{indicators.rentability.period_3.patrimonyRentability}}</td>
                                <td>{{indicators.rentability.period_2.patrimonyRentability}}</td>
                                <td>{{indicators.rentability.period_1.patrimonyRentability}}</td>
                            </tr>
    
                        </table>
    
                    </td>
    
                    
    
                </tr>
    
                
            </table>
        </td>
     </tr>
    
    
 </div>
 <div class="graph-section">

    <tr>
        <td>
    
            <table>
                <tr>
    
                    <td class="columna" width="60%" style="text-align: center; height: 200px;">
                        <canvas id="margenbrutoChart"></canvas>
                    </td>
                    <td class="columna" width="60%" style="text-align: center; height: 200px;">
                        <canvas id="ebitdaChart"></canvas>
                    </td>
                    <td class="columna" width="60%" style="text-align: center; height: 200px;">
                        <canvas id="margennetoChart"></canvas>
                    </td>
                </tr>
    
            </table>
    
        </td>
    </tr>
 </div>



 <script>
    // Función para convertir números regionales a formato estándar
    function parseNumber(numberString) {
        // Reemplazar puntos (separador de miles) por nada y comas (separador decimal) por puntos
        return parseFloat(numberString.replace(/\./g, '').replace(',', '.'));
    }

    // Configuración general para los gráficos
    function createChart(ctx, label, data, color) {
        return new Chart(ctx, {
            type: "bar",
            data: {
                labels: ["Periodo 3", "Periodo 2", "Periodo 1"],
                datasets: [
                    {
                        label: label,
                        data: data,
                        backgroundColor: data.map((value, index) => {
    const gradient = ctx.createLinearGradient(0, 0, 0, ctx.canvas.height);
    const intensity = value / Math.max(...data); // Normalización

    // Calculamos los colores inicial y final basados en el color base #488b8f
    const baseColor = [72, 139, 143]; // RGB de #488b8f
    const startColor = `rgb(${Math.floor(baseColor[0] + intensity * 20)}, ${Math.floor(baseColor[1] + intensity * 10)}, ${Math.floor(baseColor[2])})`; // Color más claro
    const endColor = `rgb(${Math.floor(baseColor[0] - intensity * 20)}, ${Math.floor(baseColor[1] - intensity * 10)}, ${Math.floor(baseColor[2])})`; // Color más oscuro

    gradient.addColorStop(0, startColor);
    gradient.addColorStop(1, endColor);
    return gradient;
}),
                        borderColor: [
                            "rgba(72, 139, 143)",
                            "rgba(72, 139, 143)",
                            "rgba(72, 139, 143)"
                        ],
                        borderWidth: 1,
                        borderRadius: 10
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: "top",
                        labels: {
                        boxWidth: 0 // Esto elimina el cuadro de color al lado del texto
                    }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        stepSize: 100000, // Paso ajustado para valores grandes
                        max: Math.max(...data) * 1.1 // Margen superior para acomodar mejor las barras
                    }
                },
                animation: {
                    duration: 0 // Sin animación
                }
            }
        });
    }

    // Procesar filas de datos y generar gráficos
    function setupCharts() {
        const margenbrutoRow = document.getElementById("margenbruto");
        const margenebitdaRow = document.getElementById("ebitda");
        const margennetoRow = document.getElementById("margenneto");
        function getDataFromRow(row) {
        return Array.from(row?.querySelectorAll("td") || [])
            .slice(1)
            .map(cell => {
                const value = parseNumber(cell.textContent.trim());
                return isNaN(value) ? 0 : value; // Si no es un número, poner 0
            });
    }

        const margenbrutoData = getDataFromRow(margenbrutoRow);
        const margenebitdaData = getDataFromRow(margenebitdaRow);
        const margennetoData = getDataFromRow(margennetoRow);

        const margenbrutoCtx = document.getElementById("margenbrutoChart").getContext("2d");
        const margenebitdaCtx = document.getElementById("ebitdaChart").getContext("2d");
        const margennetoCtx = document.getElementById("margennetoChart").getContext("2d");

        createChart(margenbrutoCtx, "Margen bruto", margenbrutoData);
        createChart(margenebitdaCtx , "EBITDA", margenebitdaData);
        createChart(margennetoCtx, "Margen neto", margennetoData);
    }

    // Inicializar gráficos
    setupCharts();
</script>



<!-- INDICADORES DE RIESGO FINANCIERO -->

<div class="table-section">
    <tr style="margin-top:10px">
        <td>
            <table width="100%" style="margin: 1px 0px 30px 0px;">
                <tr>
                    <td class="contenedor-columnas" width="40%">
                        
                        <table class="tables-body" width="100%">
                            <caption class="subtitulos" style="margin-top: 30px !important;">Indicadores de Riesgo Financiero</caption>
                            <tr class="tables-headers">
                                <th>Indicador</th>
                                <th>{{indicators.financialRisk.period_3.period | stringformat:"i"}}</th>
                                <th>{{indicators.financialRisk.period_2.period | stringformat:"i"}}</th>
                                <th>{{indicators.financialRisk.period_1.period | stringformat:"i"}}</th>
                            </tr>
    
                            <tr id="razoncorriente">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">Razón Corriente</td>
                                <td>{{indicators.financialRisk.period_3.currentReason}}</td>
                                <td>{{indicators.financialRisk.period_2.currentReason}}</td>
                                <td>{{indicators.financialRisk.period_1.currentReason}}</td>
                            </tr>
    
                            <tr id="capitaltrabajo">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">Capital de Trabajo</td>
                                <td>{{indicators.financialRisk.period_3.workingCapital}}</td>
                                <td>{{indicators.financialRisk.period_2.workingCapital}}</td>
                                <td>{{indicators.financialRisk.period_1.workingCapital}}</td>
                            </tr>
    
                            <tr id="endeudamiento">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">Endeudamiento</td>
                                <td>{{indicators.financialRisk.period_3.debt}}</td>
                                <td>{{indicators.financialRisk.period_2.debt}}</td>
                                <td>{{indicators.financialRisk.period_1.debt}}</td>
                            </tr>
    
                            <tr id="costpromdeudafinanciera">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">Costo Prom. Deuda Financiera</td>
                                <td>{{indicators.financialRisk.period_3.avgFinancialDebt}}</td>
                                <td>{{indicators.financialRisk.period_2.avgFinancialDebt}}</td>
                                <td>{{indicators.financialRisk.period_1.avgFinancialDebt}}</td>
                            </tr>
    
                            <tr id="deudafinacieraebitda">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">Deuda Financiera / EBITDA</td>
                                <td>{{indicators.financialRisk.period_3.financialDebt_EBITDA}}</td>
                                <td>{{indicators.financialRisk.period_2.financialDebt_EBITDA}}</td>
                                <td>{{indicators.financialRisk.period_1.financialDebt_EBITDA}}</td>
                            </tr>
    
                            <tr id="ebitdagastosfinancieros">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">EBITDA / Gastos Financieros</td>
                                <td>{{indicators.financialRisk.period_3.EBITDA_financialExpenses}}</td>
                                <td>{{indicators.financialRisk.period_2.EBITDA_financialExpenses}}</td>
                                <td>{{indicators.financialRisk.period_1.EBITDA_financialExpenses}}</td>
                            </tr>
    
                            <tr id="ebitdaservdeladeuda">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">EBITDA / Serv. de la Deuda</td>
                                <td>{{indicators.financialRisk.period_3.EBITDA_debtServices}}</td>
                                <td>{{indicators.financialRisk.period_2.EBITDA_debtServices}}</td>
                                <td>{{indicators.financialRisk.period_1.EBITDA_debtServices}}</td>
                            </tr>
    
                            <tr id="pagadoplusprimapatrimonio">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">Pagado + Prima / Patrimonio</td>
                                <td>{{indicators.financialRisk.period_3.payedCapital_prim_totalPatrimony}}</td>
                                <td>{{indicators.financialRisk.period_2.payedCapital_prim_totalPatrimony}}</td>
                                <td>{{indicators.financialRisk.period_1.payedCapital_prim_totalPatrimony}}</td>
                            </tr>
    
                        </table>
    
                    </td>
    
                   
    
                </tr>
                
            </table>

        
        </td>
     </tr>

</div>

<div class="graph-section"> 

    <tr style="margin-top:10px">
        <td>
     <table>
                <tr>
                    <td class="columna" style="text-align: center; height: 200px; width: 33%; padding: 10px;">
                        <canvas id="endeudamientoChart" style="max-width: 100%; height: auto;"></canvas>
                    </td>
                    <td class="columna" style="text-align: center; height: 200px; width: 33%; padding: 10px;">
                        <canvas id="ebitdagastosfinancierosChart" style="max-width: 100%; height: auto;"></canvas>
                    </td>
                    <td class="columna" style="text-align: center; height: 200px; width: 33%; padding: 10px;">
                        <canvas id="capitaltrabajoChart" style="max-width: 100%; height: auto;"></canvas>
                    </td>
                </tr>
                
     </table>

    </td>
</tr>
</div>                
       

         <script>
            // Función para convertir números regionales a formato estándar
            function parseNumber(numberString) {
                // Reemplazar puntos (separador de miles) por nada y comas (separador decimal) por puntos
                return parseFloat(numberString.replace(/\./g, '').replace(',', '.'));
            }
        
            // Configuración general para los gráficos
            function createChart(ctx, label, data, color) {
                return new Chart(ctx, {
                    type: "bar",
                    data: {
                        labels: ["Periodo 3", "Periodo 2", "Periodo 1"],
                        datasets: [
                            {
                                label: label,
                                data: data,
                                backgroundColor: data.map((value, index) => {
    const gradient = ctx.createLinearGradient(0, 0, 0, ctx.canvas.height);
    const intensity = value / Math.max(...data); // Normalización

    // Calculamos los colores inicial y final basados en el color base #488b8f
    const baseColor = [72, 139, 143]; // RGB de #488b8f
    const startColor = `rgb(${Math.floor(baseColor[0] + intensity * 20)}, ${Math.floor(baseColor[1] + intensity * 10)}, ${Math.floor(baseColor[2])})`; // Color más claro
    const endColor = `rgb(${Math.floor(baseColor[0] - intensity * 20)}, ${Math.floor(baseColor[1] - intensity * 10)}, ${Math.floor(baseColor[2])})`; // Color más oscuro

    gradient.addColorStop(0, startColor);
    gradient.addColorStop(1, endColor);
    return gradient;
}),
                                borderColor: [
                                    "rgba(72, 139, 143)",
                                    "rgba(72, 139, 143)",
                                    "rgba(72, 139, 143)"
                                ],
                                borderWidth: 1,
                                borderRadius: 10
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: "top",
                                labels: {
                        boxWidth: 0 // Esto elimina el cuadro de color al lado del texto
                    }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                stepSize: 100000, // Paso ajustado para valores grandes
                                max: Math.max(...data) * 1.1 // Margen superior para acomodar mejor las barras
                            }
                        },
                        animation: {
                            duration: 0 // Sin animación
                        }
                    }
                });
            }
        
            // Procesar filas de datos y generar gráficos
            function setupCharts() {
                const walletRow = document.getElementById("endeudamiento");
                const inventoryRotationRow = document.getElementById("ebitdagastosfinancieros");
                const capitaltrabajoRow = document.getElementById("capitaltrabajo");
                function getDataFromRow(row) {
                    return Array.from(row?.querySelectorAll("td") || [])
                        .slice(1)
                        .map(cell => {
                            const value = parseNumber(cell.textContent.trim());
                            return isNaN(value) ? 0 : value; // Si no es un número, poner 0
                        });
                }
                
                const walletData = getDataFromRow(walletRow)
                const inventoryData = getDataFromRow(inventoryRotationRow)
                const capitaltrabajoData = getDataFromRow(capitaltrabajoRow)
        
                const walletCtx = document.getElementById("endeudamientoChart").getContext("2d");
                const inventoryCtx = document.getElementById("ebitdagastosfinancierosChart").getContext("2d");
                const capitaltrabajoCtx = document.getElementById("capitaltrabajoChart").getContext("2d");
        
                createChart(walletCtx, "Endeudamiento", walletData);
                createChart(inventoryCtx, "EBITDA / Gastos Financieros", inventoryData);
                createChart(capitaltrabajoCtx, "Capital de Trabajo", capitaltrabajoData);
            }
        
            // Inicializar gráficos
            setupCharts();
        </script>
        





        

<!-- INDICADORES DE RESULTADO -->  
<div class="table-section">


    <tr style="margin-top:10px">
        <td>
            <table width="100%" style="margin: 30px 0 30px;">
                <tr>
                    <td class="contenedor-columnas" width="40%">
                        
                        <table class="tables-body" width="100%">
                            <caption class="subtitulos">Indicadores de Resultado</caption>
                            <tr class="tables-headers">
                                <th>Indicador</th>
                                <th>{{indicators.results.period_3.period | stringformat:"i"}}</th>
                                <th>{{indicators.results.period_2.period | stringformat:"i"}}</th>
                                <th>{{indicators.results.period_1.period | stringformat:"i"}}</th>
                            </tr>
    
                            <tr id="ventas">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">Ventas</td>
                                <td>{{indicators.results.period_3.sales}}</td>
                                <td>{{indicators.results.period_2.sales}}</td>
                                <td>{{indicators.results.period_1.sales}}</td>
                            </tr>
    
                            <tr id="factprommes">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">Facturación Prom. Mes</td>
                                <td>{{indicators.results.period_3.avgMonthBilling}}</td>
                                <td>{{indicators.results.period_2.avgMonthBilling}}</td>
                                <td>{{indicators.results.period_1.avgMonthBilling}}</td>
                            </tr>
    
                            <tr id="descuentosrebajasventas">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">% Descuentos y Rebajas / Ventas%</td>
                                <td>{{indicators.results.period_3.discountsSalesRefunds}}</td>
                                <td>{{indicators.results.period_2.discountsSalesRefunds}}</td>
                                <td>{{indicators.results.period_1.discountsSalesRefunds}}</td>
                            </tr>
    
                            <tr id="costpromdeudafinancierados">
                                <td style="text-align: left; font-weight: bold; padding: 3px 0 3px;">Costo Prom. Deuda Financiera</td>
                                <td>{{indicators.financialRisk.period_3.avgFinancialDebt}}</td>
                                <td>{{indicators.financialRisk.period_2.avgFinancialDebt}}</td>
                                <td>{{indicators.financialRisk.period_1.avgFinancialDebt}}</td>
                            </tr>
    
                        </table>
    
                    </td>
    
                    
                </tr>
                
            </table>
        </td>
     </tr>
    
    
</div>
<tr style="margin-top:10px">
    <td>
 <table>

    <tr>
        <td class="columna" width="60%" style="text-align: center; height: 200px;">
            <canvas id="ventasChart"></canvas>
        
    </tr>
 </table>
</td>
</tr>
<div class="graph-section">

</div>
 
<script>
    // Función para convertir números regionales a formato estándar
    function parseNumber(numberString) {
        // Reemplazar puntos (separador de miles) por nada y comas (separador decimal) por puntos
        return parseFloat(numberString.replace(/\./g, '').replace(',', '.'));
    }

    // Configuración general para los gráficos
    function createChart(ctx, label, data, color) {
        return new Chart(ctx, {
            type: "bar",
            data: {
                labels: ["Periodo 3", "Periodo 2", "Periodo 1"],
                datasets: [
                    {
                        label: label,
                        data: data,
                        backgroundColor: data.map((value, index) => {
    const gradient = ctx.createLinearGradient(0, 0, 0, ctx.canvas.height);
    const intensity = value / Math.max(...data); // Normalización

    // Calculamos los colores inicial y final basados en el color base #488b8f
    const baseColor = [72, 139, 143]; // RGB de #488b8f
    const startColor = `rgb(${Math.floor(baseColor[0] + intensity * 20)}, ${Math.floor(baseColor[1] + intensity * 10)}, ${Math.floor(baseColor[2])})`; // Color más claro
    const endColor = `rgb(${Math.floor(baseColor[0] - intensity * 20)}, ${Math.floor(baseColor[1] - intensity * 10)}, ${Math.floor(baseColor[2])})`; // Color más oscuro

    gradient.addColorStop(0, startColor);
    gradient.addColorStop(1, endColor);
    return gradient;
}),
                        borderColor: [
                            "rgba(72, 139, 143)",
                            "rgba(72, 139, 143)",
                            "rgba(72, 139, 143)"
                        ],
                        borderWidth: 1,
                        borderRadius: 10
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: "top",
                        labels: {
                        boxWidth: 0 // Esto elimina el cuadro de color al lado del texto
                    }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        stepSize: 100000, // Paso ajustado para valores grandes
                        max: Math.max(...data) * 1.1 // Margen superior para acomodar mejor las barras
                    }
                },
                animation: {
                    duration: 0 // Sin animación
                }
            }
        });
    }

    // Procesar filas de datos y generar gráficos
    function setupCharts() {
        const ventasRow = document.getElementById("ventas");
        function getDataFromRow(row) {
                    return Array.from(row?.querySelectorAll("td") || [])
                        .slice(1)
                        .map(cell => {
                            const value = parseNumber(cell.textContent.trim());
                            return isNaN(value) ? 0 : value; // Si no es un número, poner 0
                        });
                }    
        const ventasData = getDataFromRow(ventasRow);
        

        const ventasCtx = document.getElementById("ventasChart").getContext("2d");
       
        createChart(ventasCtx, "Ventas", ventasData);
       
    }

    // Inicializar gráficos
    setupCharts();
</script>
</div>

</body>

</html>